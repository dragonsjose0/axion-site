<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2103/2103832.png" type="image/png">
    
    <title>AXION V4 | Neural Interface</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        :root {
            /* Palette Neon Pro */
            --bg-deep: #030304;
            --bg-sidebar: #08080a;
            --glass-panel: rgba(20, 20, 25, 0.7);
            --glass-border: rgba(255, 255, 255, 0.08);
            
            --primary: #3b82f6;
            --primary-glow: rgba(59, 130, 246, 0.4);
            --accent: #8b5cf6;
            --accent-glow: rgba(139, 92, 246, 0.4);
            
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            
            --radius: 16px;
            --font-body: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            background-color: var(--bg-deep);
            color: var(--text-primary);
            font-family: var(--font-body);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* Scrollbar Customizada */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* --- LOGIN OVERLAY --- */
        #auth-layer {
            position: fixed; inset: 0;
            background: rgba(3, 3, 4, 0.95);
            backdrop-filter: blur(20px);
            z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 0.5s ease, visibility 0.5s;
        }
        
        .auth-card {
            background: #111;
            border: 1px solid var(--glass-border);
            padding: 40px;
            border-radius: 24px;
            width: 100%; max-width: 380px;
            text-align: center;
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.1);
            animation: floatUp 0.6s ease-out;
            position: relative;
        }
        
        .brand-logo {
            font-size: 2.5rem; font-weight: 700; letter-spacing: -1px;
            background: linear-gradient(135deg, #fff 30%, var(--primary));
            -webkit-background-clip: text; color: transparent;
            margin-bottom: 30px; display: inline-block;
        }

        .btn-full {
            width: 100%; padding: 14px;
            border-radius: 12px; font-weight: 500; font-size: 0.95rem;
            cursor: pointer; transition: all 0.2s; border: none;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            margin-bottom: 12px;
            position: relative;
        }
        
        /* BotÃ£o Google Customizado (Container para o botÃ£o oficial) */
        .google-btn-wrapper {
            margin-bottom: 15px;
            height: 48px;
            width: 100%;
            display: flex;
            justify-content: center;
        }
        
        .btn-anon { background: rgba(255,255,255,0.05); color: var(--text-secondary); border: 1px solid var(--glass-border); }
        .btn-anon:hover { background: rgba(255,255,255,0.1); color: white; border-color: rgba(255,255,255,0.2); }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 260px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--glass-border);
            display: flex; flex-direction: column;
            padding: 16px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
        }

        .new-chat-btn {
            background: linear-gradient(90deg, var(--primary), var(--accent));
            color: white; border: none; padding: 12px;
            border-radius: 12px; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.25);
            transition: transform 0.2s;
        }
        .new-chat-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 25px rgba(59, 130, 246, 0.35); }

        .history-list {
            flex: 1; overflow-y: auto; margin-top: 24px;
            display: flex; flex-direction: column; gap: 4px;
        }

        .chat-row {
            padding: 10px 12px; border-radius: 8px;
            cursor: pointer; color: var(--text-secondary);
            font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            transition: all 0.2s; position: relative;
        }
        .chat-row:hover { background: rgba(255,255,255,0.03); color: white; }
        .chat-row.active { background: rgba(59, 130, 246, 0.1); color: var(--primary); }
        
        .chat-row .del-btn {
            position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
            color: #ef4444; opacity: 0; padding: 4px; border-radius: 4px;
            transition: 0.2s;
        }
        .chat-row:hover .del-btn { opacity: 1; }
        .chat-row .del-btn:hover { background: rgba(239, 68, 68, 0.1); }

        .user-profile {
            margin-top: auto; padding-top: 16px; border-top: 1px solid var(--glass-border);
            display: flex; align-items: center; gap: 10px;
        }
        .avatar {
            width: 32px; height: 32px; border-radius: 50%;
            background: var(--glass-border); display: flex; align-items: center; justify-content: center;
            font-weight: 600; font-size: 0.8rem; color: #fff;
            overflow: hidden;
        }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }

        /* --- MAIN CHAT AREA --- */
        .main-content {
            flex: 1; display: flex; flex-direction: column;
            position: relative;
            background: radial-gradient(circle at 50% -20%, rgba(59, 130, 246, 0.05), transparent 60%);
        }

        .mobile-nav {
            display: none; padding: 16px; border-bottom: 1px solid var(--glass-border);
            align-items: center; justify-content: space-between;
            background: var(--bg-deep); z-index: 10;
        }

        /* Welcome Screen */
        .welcome-view {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 20px; text-align: center;
            animation: fadeIn 0.4s;
        }
        
        .welcome-title {
            font-size: 2rem; margin: 0 0 10px; font-weight: 600;
            background: linear-gradient(to right, #fff, #888);
            -webkit-background-clip: text; color: transparent;
        }

        .prompts-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
            width: 100%; max-width: 600px; margin-top: 30px;
        }
        
        .prompt-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--glass-border);
            padding: 16px; border-radius: 12px;
            text-align: left; cursor: pointer; transition: 0.2s;
        }
        .prompt-card:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }
        .prompt-card i { color: var(--primary); margin-bottom: 8px; display: block; }
        .prompt-card h4 { margin: 0; font-size: 0.95rem; color: white; }
        .prompt-card p { margin: 4px 0 0; font-size: 0.8rem; color: var(--text-secondary); }

        /* Messages */
        .chat-scroll {
            flex: 1; overflow-y: auto; padding: 20px;
            display: none; scroll-behavior: smooth;
        }
        .messages-wrapper { max-width: 800px; margin: 0 auto; padding-bottom: 40px; }

        .msg { display: flex; gap: 16px; margin-bottom: 32px; animation: slideIn 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .msg.user { flex-direction: row-reverse; }
        
        .msg-avatar {
            width: 36px; height: 36px; border-radius: 10px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .msg.ai .msg-avatar { background: linear-gradient(135deg, var(--primary), var(--accent)); box-shadow: 0 0 15px var(--primary-glow); }
        .msg.user .msg-avatar { background: #333; }

        .msg-bubble {
            flex: 1; max-width: 85%;
            font-size: 1rem; line-height: 1.6;
            color: #ececec;
        }
        .msg.user .msg-bubble { 
            background: rgba(255,255,255,0.05); 
            padding: 10px 16px; 
            border-radius: 12px;
            border-bottom-right-radius: 2px;
        }
        
        /* Markdown Styles */
        .msg-bubble p { margin: 0 0 10px; }
        .msg-bubble p:last-child { margin: 0; }
        .msg-bubble pre { 
            background: #141416; border-radius: 8px; border: 1px solid #333; 
            overflow: hidden; margin: 12px 0; 
        }
        .msg-bubble code { font-family: var(--font-code); font-size: 0.9em; }
        .code-header {
            background: #1f1f22; padding: 6px 12px;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.75rem; color: #888; border-bottom: 1px solid #333;
        }
        .copy-btn { background: none; border: none; color: inherit; cursor: pointer; font-size: 0.75rem; }
        .copy-btn:hover { color: white; }

        /* Input Area */
        .input-container {
            padding: 24px;
            background: linear-gradient(to top, var(--bg-deep) 70%, transparent);
            position: sticky; bottom: 0;
        }
        
        .input-box {
            max-width: 800px; margin: 0 auto;
            background: #1a1a1c;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 8px;
            display: flex; align-items: flex-end; gap: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            transition: border-color 0.2s;
        }
        .input-box:focus-within { border-color: var(--primary); }

        textarea {
            flex: 1; background: transparent; border: none;
            color: white; font-family: var(--font-body); font-size: 1rem;
            resize: none; max-height: 200px; padding: 12px;
            outline: none;
        }

        .send-btn {
            width: 40px; height: 40px; border-radius: 10px;
            background: var(--text-primary); color: var(--bg-deep);
            border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .send-btn:hover { background: var(--primary); color: white; }
        .send-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Responsividade */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed; top: 0; left: 0; height: 100%;
                transform: translateX(-100%); width: 80%;
                box-shadow: 50px 0 100px rgba(0,0,0,0.5);
            }
            .sidebar.show { transform: translateX(0); }
            .mobile-nav { display: flex; }
            .prompts-grid { grid-template-columns: 1fr; }
        }

        @keyframes floatUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <div id="auth-layer">
        <div class="auth-card">
            <div class="brand-logo">AXION</div>
            <p style="color:var(--text-secondary); margin-bottom:30px;">Interface Neural V4.0</p>
            
            <div class="google-btn-wrapper">
                <div id="g_id_onload"
                     data-client_id="SEU_CLIENT_ID_DO_GOOGLE_AQUI" 
                     data-context="signin"
                     data-ux_mode="popup"
                     data-callback="handleGoogleLogin"
                     data-auto_prompt="false">
                </div>
                <div class="g_id_signin"
                     data-type="standard"
                     data-shape="rectangular"
                     data-theme="outline"
                     data-text="continue_with"
                     data-size="large"
                     data-logo_alignment="left"
                     data-width="280">
                </div>
            </div>

            <button class="btn-full btn-anon" onclick="App.login('guest')">
                <i class="fas fa-user-secret"></i> Acesso Visitante
            </button>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <button class="new-chat-btn" onclick="App.startNewChat()">
            <i class="fas fa-plus"></i> Novo Chat
        </button>

        <div class="history-list" id="chat-list">
            </div>

        <div class="user-profile">
            <div class="avatar" id="u-avatar">U</div>
            <div style="flex:1; overflow:hidden;">
                <div id="u-name" style="font-weight:500; font-size:0.9rem;">UsuÃ¡rio</div>
                <div id="u-email" style="font-size:0.75rem; color:#666; text-overflow:ellipsis; overflow:hidden;">Online</div>
            </div>
            <i class="fas fa-sign-out-alt" onclick="App.logout()" title="Sair" style="cursor:pointer; color:#555;"></i>
        </div>
    </div>

    <div class="main-content">
        <div class="mobile-nav">
            <i class="fas fa-bars" onclick="document.getElementById('sidebar').classList.add('show')"></i>
            <span style="font-weight:600; letter-spacing:1px;">AXION</span>
            <i class="fas fa-pen-nib" onclick="App.startNewChat()"></i>
        </div>

        <div onclick="document.getElementById('sidebar').classList.remove('show')" 
             style="position:absolute; inset:0; z-index:90; display:none;" 
             id="sidebar-overlay"></div>

        <div id="welcome-view" class="welcome-view">
            <div style="font-size:3rem; margin-bottom:10px;">ðŸ’ </div>
            <h2 class="welcome-title">OlÃ¡, <span id="welcome-name">Visitante</span></h2>
            <p style="color:var(--text-secondary);">Como posso expandir sua inteligÃªncia hoje?</p>

            <div class="prompts-grid">
                <div class="prompt-card" onclick="App.setInput('Crie um script em Python para automaÃ§Ã£o de arquivos.')">
                    <i class="fab fa-python"></i>
                    <h4>Gerar CÃ³digo</h4>
                    <p>Python, JS, algoritmos complexos.</p>
                </div>
                <div class="prompt-card" onclick="App.setInput('Me explique a computaÃ§Ã£o quÃ¢ntica de forma simples.')">
                    <i class="fas fa-atom"></i>
                    <h4>Conceitos Complexos</h4>
                    <p>CiÃªncia, FÃ­sica e Tecnologia.</p>
                </div>
                <div class="prompt-card" onclick="App.setInput('Escreva um e-mail profissional recusando um convite educadamente.')">
                    <i class="fas fa-envelope-open-text"></i>
                    <h4>Escrita Profissional</h4>
                    <p>E-mails, relatÃ³rios e textos.</p>
                </div>
                <div class="prompt-card" onclick="App.setInput('Crie um roteiro de viagem de 3 dias para TÃ³quio.')">
                    <i class="fas fa-plane"></i>
                    <h4>Criatividade</h4>
                    <p>Ideias, roteiros e brainstorming.</p>
                </div>
            </div>
        </div>

        <div id="chat-view" class="chat-scroll">
            <div class="messages-wrapper" id="msgs-container"></div>
        </div>

        <div class="input-container">
            <div class="input-box">
                <textarea id="user-input" rows="1" placeholder="Envie uma mensagem..."
                    oninput="this.style.height='auto'; this.style.height = Math.min(this.scrollHeight, 200) + 'px'"
                    onkeydown="if(event.key==='Enter' && !event.shiftKey){ event.preventDefault(); App.sendMessage(); }"></textarea>
                <button id="send-btn" class="send-btn" onclick="App.sendMessage()">
                    <i class="fas fa-arrow-up"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        /* ================= CONFIGURAÃ‡ÃƒO ================= */
        const API_URL = "SUA_URL_DO_WORKER_AQUI"; // << COLOQUE A URL DO SEU WORKER AQUI

        /* --- GOOGLE AUTH HANDLER (Global) --- */
        function handleGoogleLogin(response) {
            // Decodifica o JWT para pegar dados do usuÃ¡rio (sem backend)
            const responsePayload = decodeJwtResponse(response.credential);
            
            const user = {
                name: responsePayload.name,
                email: responsePayload.email,
                avatar: responsePayload.picture,
                type: 'google'
            };
            
            App.completeLogin(user);
        }

        function decodeJwtResponse(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        const App = {
            state: {
                user: null,
                chats: [],
                activeChatId: null,
                isTyping: false
            },

            init() {
                // Carrega dados locais
                try {
                    const savedUser = localStorage.getItem('axion_user');
                    if (savedUser) this.state.user = JSON.parse(savedUser);
                    
                    const savedHistory = localStorage.getItem('axion_history');
                    if (savedHistory) this.state.chats = JSON.parse(savedHistory);
                } catch(e) {
                    console.error("Erro ao carregar dados", e);
                }

                // Config Marked.js
                marked.setOptions({
                    highlight: (code, lang) => hljs.highlightAuto(code).value,
                    breaks: true
                });

                if (this.state.user) {
                    this.showInterface();
                }

                // Ajuste mobile Overlay
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                
                // Observador para mostrar/esconder overlay
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.target.classList.contains('show')) {
                            overlay.style.display = 'block';
                        } else {
                            overlay.style.display = 'none';
                        }
                    });
                });
                observer.observe(sidebar, { attributes: true, attributeFilter: ['class'] });
            },

            /* --- AUTENTICAÃ‡ÃƒO --- */
            login(type) {
                if(type === 'guest') {
                    const user = { 
                        name: "Visitante", 
                        email: "Modo AnÃ´nimo", 
                        avatar: null, // null usarÃ¡ a letra inicial
                        type: 'guest'
                    };
                    this.completeLogin(user);
                }
            },

            completeLogin(user) {
                this.state.user = user;
                localStorage.setItem('axion_user', JSON.stringify(user));
                
                const authLayer = document.getElementById('auth-layer');
                authLayer.style.opacity = '0';
                authLayer.style.visibility = 'hidden'; // Garante que nÃ£o Ã© clicÃ¡vel
                
                setTimeout(() => {
                    authLayer.style.display = 'none';
                    this.showInterface();
                }, 500);
            },

            logout() {
                localStorage.removeItem('axion_user');
                location.reload();
            },

            showInterface() {
                // Remove layer caso ainda esteja visÃ­vel por algum erro
                document.getElementById('auth-layer').style.display = 'none';
                
                // Atualiza UI
                document.getElementById('u-name').innerText = this.state.user.name;
                document.getElementById('u-email').innerText = this.state.user.email;
                
                const avatarEl = document.getElementById('u-avatar');
                if (this.state.user.avatar) {
                    avatarEl.innerHTML = `<img src="${this.state.user.avatar}" alt="Avatar">`;
                } else {
                    avatarEl.innerText = this.state.user.name.charAt(0).toUpperCase();
                }
                
                document.getElementById('welcome-name').innerText = this.state.user.name.split(' ')[0];
                this.renderHistory();
            },

            /* --- CHAT LOGIC --- */
            startNewChat() {
                this.state.activeChatId = null;
                this.toggleView('welcome');
                document.getElementById('user-input').value = '';
                document.getElementById('user-input').focus();
                document.getElementById('sidebar').classList.remove('show');
                this.renderHistory();
            },

            loadChat(id) {
                this.state.activeChatId = id;
                const chat = this.state.chats.find(c => c.id === id);
                if (!chat) return;

                const container = document.getElementById('msgs-container');
                container.innerHTML = '';
                chat.messages.forEach(msg => this.renderMessage(msg.role, msg.content));
                
                this.toggleView('chat');
                this.renderHistory();
                document.getElementById('sidebar').classList.remove('show');
            },

            deleteChat(e, id) {
                e.stopPropagation();
                if(confirm("Deseja apagar esta conversa permanentemente?")) {
                    this.state.chats = this.state.chats.filter(c => c.id !== id);
                    this.saveState();
                    if(this.state.activeChatId === id) this.startNewChat();
                    else this.renderHistory();
                }
            },

            /* --- MESSAGING --- */
            async sendMessage() {
                if (this.state.isTyping) return;
                
                const input = document.getElementById('user-input');
                const text = input.value.trim();
                if (!text) return;

                input.value = '';
                input.style.height = 'auto';
                this.toggleView('chat');
                this.renderMessage('user', text);
                this.state.isTyping = true;
                this.toggleLoading(true);

                let chat = this.state.chats.find(c => c.id === this.state.activeChatId);
                if (!chat) {
                    chat = {
                        id: Date.now(),
                        title: text.substring(0, 30) + (text.length > 30 ? '...' : ''),
                        messages: []
                    };
                    this.state.chats.unshift(chat);
                    this.state.activeChatId = chat.id;
                }

                chat.messages.push({ role: 'user', content: text });
                this.saveState();

                try {
                    const response = await fetch(API_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ messages: chat.messages })
                    });

                    const data = await response.json();
                    
                    this.toggleLoading(false);
                    const aiReply = data.reply || "Erro desconhecido na resposta.";
                    
                    this.renderMessage('ai', aiReply);
                    chat.messages.push({ role: 'assistant', content: aiReply });
                    this.saveState();

                } catch (error) {
                    this.toggleLoading(false);
                    this.renderMessage('ai', "âš ï¸ Erro de conexÃ£o. Verifique se o Worker estÃ¡ online.");
                } finally {
                    this.state.isTyping = false;
                    // MantÃ©m o foco no input
                    setTimeout(() => document.getElementById('user-input').focus(), 100);
                }
            },

            /* --- UTILS --- */
            renderMessage(role, text) {
                const container = document.getElementById('msgs-container');
                const div = document.createElement('div');
                div.className = `msg ${role}`;
                
                let content = text;
                if (role === 'ai') {
                    content = marked.parse(text);
                } else {
                    content = text.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, "<br>");
                }

                div.innerHTML = `
                    <div class="msg-avatar">${role === 'ai' ? 'ðŸ’ ' : '<i class="fas fa-user"></i>'}</div>
                    <div class="msg-bubble">${content}</div>
                `;

                if(role === 'ai') {
                    div.querySelectorAll('pre code').forEach(block => {
                        const pre = block.parentElement;
                        const header = document.createElement('div');
                        header.className = 'code-header';
                        header.innerHTML = `
                            <span>Code</span>
                            <button class="copy-btn" onclick="App.copyCode(this)"><i class="fas fa-copy"></i> Copiar</button>
                        `;
                        pre.insertBefore(header, block);
                    });
                }

                container.appendChild(div);
                this.scrollToBottom();
            },

            renderHistory() {
                const list = document.getElementById('chat-list');
                list.innerHTML = '';
                
                this.state.chats.forEach(chat => {
                    const el = document.createElement('div');
                    el.className = `chat-row ${chat.id === this.state.activeChatId ? 'active' : ''}`;
                    el.onclick = () => this.loadChat(chat.id);
                    el.innerHTML = `
                        <i class="far fa-comment-alt" style="margin-right:8px; font-size:0.8rem;"></i>
                        <span style="flex:1; overflow:hidden; text-overflow:ellipsis;">${chat.title}</span>
                        <i class="fas fa-trash del-btn" onclick="App.deleteChat(event, ${chat.id})"></i>
                    `;
                    list.appendChild(el);
                });
            },

            toggleView(view) {
                const welcome = document.getElementById('welcome-view');
                const chat = document.getElementById('chat-view');
                
                if (view === 'welcome') {
                    welcome.style.display = 'flex';
                    chat.style.display = 'none';
                } else {
                    welcome.style.display = 'none';
                    chat.style.display = 'block';
                }
            },

            toggleLoading(show) {
                const existing = document.getElementById('loading-indicator');
                if (existing) existing.remove();

                if (show) {
                    const container = document.getElementById('msgs-container');
                    const div = document.createElement('div');
                    div.id = 'loading-indicator';
                    div.className = 'msg ai';
                    div.innerHTML = `
                        <div class="msg-avatar">ðŸ’ </div>
                        <div class="msg-bubble" style="color:#888;">
                            <i class="fas fa-circle-notch fa-spin"></i> Processando...
                        </div>
                    `;
                    container.appendChild(div);
                    this.scrollToBottom();
                }
            },

            scrollToBottom() {
                const view = document.getElementById('chat-view');
                setTimeout(() => view.scrollTo(0, view.scrollHeight), 50);
            },

            saveState() {
                localStorage.setItem('axion_history', JSON.stringify(this.state.chats));
                this.renderHistory();
            },

            setInput(text) {
                const input = document.getElementById('user-input');
                input.value = text;
                input.focus();
            },

            copyCode(btn) {
                const code = btn.parentElement.nextElementSibling.innerText;
                navigator.clipboard.writeText(code);
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copiado';
                setTimeout(() => btn.innerHTML = originalHTML, 2000);
            }
        };

        window.onload = () => App.init();
    </script>
</body>
</html>