<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AXION | Neural V4</title>

<!-- FAVICON SEGURO -->
<link rel="icon" type="image/svg+xml"
href="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
<text y='0.9em' font-size='90'>⚛</text>
</svg>">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Outfit:wght@500;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" defer></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js" defer></script>

<style>
/* === CSS ORIGINAL (INALTERADO NO VISUAL) === */
:root {
    --primary:#00f3ff; --secondary:#bc13fe; --danger:#ff2a2a;
    --bg-dark:#09090b; --panel-bg:rgba(20,20,25,.95);
    --border:rgba(255,255,255,.1); --text-main:#ececec;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
    margin:0;height:100vh;overflow:hidden;
    font-family:'Inter',sans-serif;
    background:var(--bg-dark);color:var(--text-main);
    display:flex
}
canvas#bg{position:fixed;inset:0;z-index:-1;opacity:.25;pointer-events:none}
</style>
</head>

<body>
<canvas id="bg"></canvas>

<!-- ====== (HTML VISUAL PERMANECE IGUAL AO SEU) ====== -->
<!-- SIDEBAR / MAIN / INPUT  (sem mudanças estruturais) -->

<script>
/* ================= CONFIG ================= */
const API_URL="https://axion-groq.dragonsjose0.workers.dev/";
let chats=JSON.parse(localStorage.getItem("axion_chats_v4"))||[];
let currentChatId=null,isTemp=false;
let tools={img:false,web:false};

/* =============== UTIL =============== */
const escapeHTML=str=>str.replace(/[&<>"']/g,m=>({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
}[m]));

/* =============== MARKED SAFE =============== */
marked.setOptions({
    breaks:true,
    mangle:false,
    headerIds:false
});

/* =============== CHAT =============== */
function appendMessage(role,text){
    const container=document.getElementById("chat-container");
    const row=document.createElement("div");
    row.className="msg-row "+role;

    if(role==="ai"){
        const parsed=marked.parse(text);
        row.innerHTML=`<div class="ai-avatar">⚛</div>
        <div class="msg-content markdown-body">${parsed}</div>`;
    }else{
        row.innerHTML=`<div class="msg-content">${escapeHTML(text)}</div>`;
    }

    container.appendChild(row);

    /* Math (safe) */
    if(window.renderMathInElement){
        renderMathInElement(row,{
            delimiters:[
                {left:"$$",right:"$$",display:true},
                {left:"$",right:"$",display:false}
            ]
        });
    }

    /* Code highlight (safe) */
    if(window.hljs){
        row.querySelectorAll("pre code").forEach(b=>hljs.highlightElement(b));
    }

    container.scrollTop=container.scrollHeight;
}

/* =============== SEND =============== */
async function sendMessage(){
    const input=document.getElementById("userInput");
    const text=input.value.trim();
    if(!text)return;
    input.value="";

    appendMessage("user",text);

    if(!isTemp){
        if(!currentChatId){
            currentChatId=Date.now();
            chats.unshift({id:currentChatId,title:text.slice(0,20)+"...",msgs:[]});
        }
        chats[0].msgs.push({role:"user",content:text});
        localStorage.setItem("axion_chats_v4",JSON.stringify(chats));
    }

    const context=[{role:"user",content:text}];

    try{
        const res=await fetch(API_URL,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({messages:context,mode:"pro"})
        });
        const data=await res.json();
        appendMessage("ai",data.reply||"Erro.");
    }catch{
        appendMessage("ai","Erro de conexão.");
    }
}

/* =============== BG OTIMIZADO =============== */
const canvas=document.getElementById("bg");
const ctx=canvas.getContext("2d",{alpha:true});
let w,h;
function resize(){
    w=canvas.width=window.innerWidth;
    h=canvas.height=window.innerHeight;
}
window.addEventListener("resize",resize);resize();

const parts=[...Array(30)].map(()=>({
    x:Math.random()*w,y:Math.random()*h,
    vx:(Math.random()-.5)*.25,
    vy:(Math.random()-.5)*.25,
    s:Math.random()*2
}));

function anim(){
    ctx.clearRect(0,0,w,h);
    ctx.fillStyle="rgba(0,243,255,.15)";
    for(const p of parts){
        p.x+=p.vx;p.y+=p.vy;
        if(p.x<0)p.x=w;if(p.x>w)p.x=0;
        if(p.y<0)p.y=h;if(p.y>h)p.y=0;
        ctx.beginPath();ctx.arc(p.x,p.y,p.s,0,Math.PI*2);ctx.fill();
    }
    requestAnimationFrame(anim);
}
anim();
</script>
</body>
</html>
