<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AXION | Advanced AI</title>

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3Eüí†%3C/text%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* --- CORE VARIABLES & RESET --- */
        :root {
            --bg-app: #0f0f12; /* Fundo estilo Gemini Dark */
            --bg-sidebar: #1e1e24;
            --bg-input: #2a2a30;
            --primary: #4f8aff; /* Azul Gemini */
            --accent: #d966ff; /* Roxo sutil */
            --text-main: #ececec;
            --text-sub: #a0a0b0;
            --border: rgba(255,255,255,0.08);
            --hover: rgba(255,255,255,0.05);
            --message-user: #2b2d31;
            --font-main: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; height: 100vh; font-family: var(--font-main); background: var(--bg-app); color: var(--text-main); display: flex; overflow: hidden; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #666; }

        /* --- TELA DE LOGIN --- */
        #login-screen {
            position: fixed; inset: 0; z-index: 9999;
            background: #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s ease;
        }
        .login-card {
            width: 90%; max-width: 400px; padding: 40px;
            background: #111; border: 1px solid #333; border-radius: 24px;
            text-align: center; box-shadow: 0 0 40px rgba(79, 138, 255, 0.1);
        }
        .login-logo { font-size: 3rem; margin-bottom: 20px; background: linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip: text; color: transparent; }
        .btn-login {
            width: 100%; padding: 14px; margin-top: 20px;
            background: white; color: black; border: none; border-radius: 12px;
            font-weight: 600; font-size: 1rem; cursor: pointer; transition: 0.2s;
        }
        .btn-login:hover { transform: scale(1.02); box-shadow: 0 0 20px rgba(255,255,255,0.2); }

        /* --- SIDEBAR (Hist√≥rico) --- */
        .sidebar {
            width: 260px; background: var(--bg-sidebar); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; transition: transform 0.3s ease;
            z-index: 100;
        }
        .sidebar-header { padding: 20px; }
        .btn-new-chat {
            background: var(--hover); border: 1px solid var(--border); color: var(--text-main);
            width: 100%; padding: 12px; border-radius: 8px; cursor: pointer; text-align: left;
            display: flex; align-items: center; gap: 10px; font-size: 0.9rem; transition: 0.2s;
        }
        .btn-new-chat:hover { background: rgba(255,255,255,0.1); }
        
        .history-container { flex: 1; overflow-y: auto; padding: 10px; }
        .history-label { font-size: 0.75rem; color: var(--text-sub); padding: 10px 10px 5px; font-weight: 600; }
        
        .chat-item {
            padding: 10px 12px; border-radius: 8px; cursor: pointer;
            color: var(--text-main); font-size: 0.9rem;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            transition: 0.2s; display: flex; align-items: center; justify-content: space-between;
            group;
        }
        .chat-item:hover { background: var(--hover); }
        .chat-item.active { background: rgba(79, 138, 255, 0.15); color: var(--primary); }
        
        /* Bot√µes de A√ß√£o (Edit/Delete) - S√≥ aparecem no hover */
        .item-actions { display: none; gap: 5px; }
        .chat-item:hover .item-actions { display: flex; }
        .action-icon {
            width: 24px; height: 24px; border-radius: 4px; display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: var(--text-sub); transition: 0.2s;
        }
        .action-icon:hover { background: rgba(255,255,255,0.2); color: white; }
        .action-icon.del:hover { background: rgba(255, 50, 50, 0.3); color: #ff5555; }

        .user-footer { padding: 15px; border-top: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
        .avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(var(--primary), var(--accent)); display: grid; place-items: center; font-weight: bold; font-size: 0.8rem; }

        /* --- MAIN CHAT AREA --- */
        .main { flex: 1; display: flex; flex-direction: column; position: relative; background: var(--bg-app); }
        
        /* Welcome View (Sugest√µes) */
        #welcome-view {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; text-align: center;
        }
        .welcome-title { font-size: 2.5rem; background: linear-gradient(to right, #fff, #aaa); -webkit-background-clip: text; color: transparent; margin-bottom: 10px; font-weight: 500; }
        .suggestion-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 600px; width: 100%; margin-top: 40px; }
        .card {
            background: var(--bg-sidebar); border: 1px solid var(--border); padding: 15px;
            border-radius: 12px; text-align: left; cursor: pointer; transition: 0.2s;
        }
        .card:hover { background: var(--hover); border-color: var(--primary); }
        .card h4 { margin: 0 0 5px; color: var(--text-main); font-size: 0.95rem; }
        .card p { margin: 0; color: var(--text-sub); font-size: 0.8rem; }

        /* Chat Container */
        #chat-container {
            flex: 1; overflow-y: auto; padding: 20px; display: none; scroll-behavior: smooth;
            padding-bottom: 150px; /* Espa√ßo para o input */
        }
        .msg-row { display: flex; margin-bottom: 25px; opacity: 0; animation: fadeIn 0.3s forwards; }
        .msg-row.user { justify-content: flex-end; }
        .msg-row.ai { justify-content: flex-start; }

        .msg-bubble {
            max-width: 750px; padding: 0 15px; line-height: 1.6;
            color: var(--text-main); font-size: 1rem;
        }
        .msg-row.user .msg-bubble {
            background: var(--message-user); padding: 12px 20px; border-radius: 20px;
        }
        
        /* Markdown Styles */
        .msg-bubble h1, .msg-bubble h2, .msg-bubble h3 { margin-top: 10px; color: white; }
        .msg-bubble code { background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-family: var(--font-code); font-size: 0.9em; color: #ff79c6; }
        .msg-bubble pre { background: #16161a; padding: 15px; border-radius: 10px; overflow-x: auto; border: 1px solid var(--border); }
        .msg-bubble ul { padding-left: 20px; }
        
        /* Image Preview in Chat */
        .chat-img-display { max-width: 300px; border-radius: 10px; margin-bottom: 10px; display: block; border: 1px solid var(--border); }

        @keyframes fadeIn { to { opacity: 1; } }

        /* --- INPUT AREA FLUTUANTE --- */
        .input-wrapper {
            position: absolute; bottom: 0; left: 0; right: 0;
            padding: 20px; background: linear-gradient(transparent, var(--bg-app) 20%);
            display: flex; flex-direction: column; align-items: center;
        }

        .img-preview-container {
            background: var(--bg-input); padding: 8px; border-radius: 10px; margin-bottom: 10px;
            display: none; position: relative; border: 1px solid var(--border);
        }
        .img-preview-container img { height: 60px; border-radius: 6px; }
        .btn-close-img { position: absolute; top: -8px; right: -8px; background: #ff5555; color: white; border: none; border-radius: 50%; width: 22px; height: 22px; cursor: pointer; }

        .input-box {
            width: 100%; max-width: 800px;
            background: var(--bg-input); border: 1px solid var(--border);
            border-radius: 30px; padding: 10px 15px;
            display: flex; align-items: flex-end; gap: 10px;
            transition: 0.3s; box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .input-box:focus-within { border-color: var(--primary); box-shadow: 0 0 25px rgba(79, 138, 255, 0.15); }

        textarea {
            flex: 1; background: transparent; border: none; color: white;
            font-family: var(--font-main); font-size: 1rem; resize: none;
            max-height: 200px; padding: 10px 0; min-height: 24px;
        }

        /* Bot√µes de Ferramentas */
        .tool-btn {
            width: 36px; height: 36px; border-radius: 50%; border: none;
            background: transparent; color: var(--text-sub); cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .tool-btn:hover { background: var(--hover); color: white; }
        .tool-btn.active { color: var(--primary); background: rgba(79, 138, 255, 0.15); }
        .tool-btn svg { width: 20px; height: 20px; fill: currentColor; }

        .btn-send {
            background: white; color: black; border-radius: 50%; width: 36px; height: 36px;
            border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.2s; margin-bottom: 4px;
        }
        .btn-send:hover { transform: scale(1.1); background: var(--primary); }

        /* Loader */
        .typing-indicator { color: var(--text-sub); font-style: italic; font-size: 0.9rem; margin-left: 10px; }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { position: fixed; height: 100%; transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .suggestion-grid { grid-template-columns: 1fr; }
            .welcome-title { font-size: 1.8rem; }
            .mobile-menu-btn { display: block; position: absolute; top: 15px; left: 15px; z-index: 200; }
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <div class="login-logo">üí† AXION</div>
            <p style="color: #888; margin-bottom: 30px;">Interface Neural V3.0</p>
            <input type="text" placeholder="Seu nome" id="username-input" style="width:100%; padding:12px; background:#222; border:1px solid #444; color:white; border-radius:8px; margin-bottom:10px;">
            <button class="btn-login" onclick="performLogin()">Entrar no Sistema</button>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="btn-new-chat" onclick="createNewChat()">
                <span>+</span> Nova Conversa
            </div>
        </div>
        <div class="history-label">Recentes</div>
        <div class="history-container" id="history-list">
            </div>
        <div class="user-footer">
            <div class="avatar" id="user-avatar">U</div>
            <div style="font-size: 0.9rem; font-weight: 500;" id="user-name-display">Usu√°rio</div>
        </div>
    </div>

    <div class="main">
        
        <div class="mobile-menu-btn" style="display:none; padding:10px;" onclick="toggleSidebar()">‚ò∞</div>

        <div id="welcome-view">
            <div class="welcome-title">Ol√°, <span id="welcome-name">Humano</span></div>
            <div style="color: var(--text-sub); max-width: 500px;">
                Sou o Axion. Estou configurado para ser natural, direto e extremamente inteligente.
            </div>
            
            <div class="suggestion-grid">
                <div class="card" onclick="useSuggestion('Crie um roteiro de viagem para o Jap√£o de 7 dias')">
                    <h4>‚úàÔ∏è Planejar Viagem</h4>
                    <p>Roteiro completo para o Jap√£o</p>
                </div>
                <div class="card" onclick="useSuggestion('Explique computa√ß√£o qu√¢ntica em termos simples')">
                    <h4>üß† Aprender Algo</h4>
                    <p>Computa√ß√£o qu√¢ntica simples</p>
                </div>
                <div class="card" onclick="useSuggestion('Crie uma fun√ß√£o Python para analisar dados de vendas')">
                    <h4>üíª Codar</h4>
                    <p>Python para an√°lise de dados</p>
                </div>
                <div class="card" onclick="useSuggestion('Escreva um e-mail formal pedindo um aumento')">
                    <h4>üìù Escrever</h4>
                    <p>E-mail profissional</p>
                </div>
            </div>
        </div>

        <div id="chat-container"></div>

        <div class="input-wrapper">
            
            <div class="img-preview-container" id="img-preview-box">
                <img id="img-preview-el" src="">
                <button class="btn-close-img" onclick="clearImage()">√ó</button>
            </div>

            <div class="input-box">
                <button class="tool-btn" onclick="document.getElementById('file-input').click()" title="Anexar Imagem">
                    <svg viewBox="0 0 24 24"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 0 1 5 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 0 0 5 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/></svg>
                </button>
                <input type="file" id="file-input" hidden accept="image/*" onchange="handleFileSelect(this)">

                <button class="tool-btn" id="btn-globe" onclick="toggleDeepSearch()" title="Modo Pesquisa Profunda">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                </button>

                <textarea id="user-input" placeholder="Digite uma mensagem..." rows="1" oninput="resizeTextarea(this)" onkeydown="checkEnter(event)"></textarea>

                <button class="btn-send" onclick="sendMessage()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                </button>
            </div>
            <div style="font-size:0.7rem; color:#444; margin-top:5px;">Axion pode cometer erros. Verifique informa√ß√µes importantes.</div>
        </div>

    </div>

    <script>
        // --- CONFIGURA√á√ÉO ---
        const API_URL = "https://axion-groq.dragonsjose0.workers.dev/";

        // --- ESTADO ---
        let state = {
            user: localStorage.getItem("axion_user") || null,
            chats: JSON.parse(localStorage.getItem("axion_chats")) || [],
            currentChatId: null,
            deepMode: false,
            currentImage: null // Base64
        };

        // Se n√£o houver chats, cria um inicial
        if (state.chats.length === 0) {
            createNewChatInternal();
        } else {
            state.currentChatId = state.chats[0].id;
        }

        // --- INICIALIZA√á√ÉO ---
        window.onload = () => {
            if (state.user) {
                document.getElementById("login-screen").style.display = "none";
                updateUserInterface();
                renderSidebar();
                loadChat(state.currentChatId);
            }
        };

        // --- LOGIN ---
        function performLogin() {
            const name = document.getElementById("username-input").value.trim() || "Visitante";
            state.user = name;
            localStorage.setItem("axion_user", name);
            
            const screen = document.getElementById("login-screen");
            screen.style.opacity = "0";
            setTimeout(() => screen.style.display = "none", 500);
            
            updateUserInterface();
            renderSidebar();
            loadChat(state.currentChatId);
        }

        function updateUserInterface() {
            document.getElementById("welcome-name").innerText = state.user;
            document.getElementById("user-name-display").innerText = state.user;
            document.getElementById("user-avatar").innerText = state.user.charAt(0).toUpperCase();
        }

        // --- CORE CHAT LOGIC ---
        function createNewChat() {
            createNewChatInternal();
            renderSidebar();
            loadChat(state.currentChatId);
            // Em mobile, fecha sidebar
            if(window.innerWidth < 768) document.querySelector('.sidebar').classList.remove('open');
        }

        function createNewChatInternal() {
            const newChat = { id: Date.now(), title: "Nova Conversa", msgs: [] };
            state.chats.unshift(newChat);
            state.currentChatId = newChat.id;
            saveData();
        }

        function saveData() {
            localStorage.setItem("axion_chats", JSON.stringify(state.chats));
        }

        // --- SIDEBAR & MANIPULA√á√ÉO ---
        function renderSidebar() {
            const list = document.getElementById("history-list");
            list.innerHTML = "";
            
            state.chats.forEach(chat => {
                const item = document.createElement("div");
                item.className = `chat-item ${chat.id === state.currentChatId ? 'active' : ''}`;
                
                // Texto do chat
                const span = document.createElement("span");
                span.innerText = chat.title;
                span.style.flex = "1";
                span.onclick = () => loadChat(chat.id);

                // A√ß√µes (Editar e Deletar)
                const actions = document.createElement("div");
                actions.className = "item-actions";
                
                // Bot√£o Editar
                const btnEdit = document.createElement("div");
                btnEdit.className = "action-icon";
                btnEdit.innerHTML = "‚úé";
                btnEdit.onclick = (e) => { e.stopPropagation(); editChatTitle(chat.id); };

                // Bot√£o Deletar
                const btnDel = document.createElement("div");
                btnDel.className = "action-icon del";
                btnDel.innerHTML = "üóë";
                btnDel.onclick = (e) => { e.stopPropagation(); deleteChat(chat.id); };

                actions.appendChild(btnEdit);
                actions.appendChild(btnDel);

                item.appendChild(span);
                item.appendChild(actions);
                list.appendChild(item);
            });
        }

        function editChatTitle(id) {
            const chat = state.chats.find(c => c.id === id);
            const newTitle = prompt("Novo nome:", chat.title);
            if (newTitle) {
                chat.title = newTitle;
                saveData();
                renderSidebar();
            }
        }

        function deleteChat(id) {
            if (confirm("Tem certeza que deseja excluir esta conversa?")) {
                state.chats = state.chats.filter(c => c.id !== id);
                if (state.chats.length === 0) createNewChatInternal();
                else state.currentChatId = state.chats[0].id;
                
                saveData();
                renderSidebar();
                loadChat(state.currentChatId);
            }
        }

        // --- CARREGAR CONVERSA ---
        function loadChat(id) {
            state.currentChatId = id;
            const chat = state.chats.find(c => c.id === id);
            const container = document.getElementById("chat-container");
            const welcome = document.getElementById("welcome-view");

            renderSidebar(); // Atualiza sele√ß√£o visual

            container.innerHTML = "";

            if (chat.msgs.length === 0) {
                welcome.style.display = "flex";
                container.style.display = "none";
            } else {
                welcome.style.display = "none";
                container.style.display = "block";
                chat.msgs.forEach(m => renderMessage(m));
                scrollToBottom();
            }
        }

        function renderMessage(msg) {
            const container = document.getElementById("chat-container");
            const row = document.createElement("div");
            row.className = `msg-row ${msg.role}`;
            
            let contentHtml = "";
            
            // Se tiver imagem
            if (msg.image) {
                contentHtml += `<img src="${msg.image}" class="chat-img-display">`;
            }

            // Parse Markdown apenas para AI
            if (msg.role === 'ai') {
                contentHtml += marked.parse(msg.content);
            } else {
                contentHtml += msg.content.replace(/\n/g, "<br>");
            }

            // Avatar da AI
            const avatar = msg.role === 'ai' 
                ? `<div style="width:30px; margin-right:10px;">üí†</div>` 
                : ``;

            // HTML Interno
            row.innerHTML = `
                ${msg.role === 'ai' ? avatar : ''}
                <div class="msg-bubble">${contentHtml}</div>
            `;
            
            container.appendChild(row);
        }

        function scrollToBottom() {
            const c = document.getElementById("chat-container");
            c.scrollTop = c.scrollHeight;
        }

        // --- ENVIO DE MENSAGENS ---
        async function sendMessage() {
            const input = document.getElementById("user-input");
            const text = input.value.trim();
            const image = state.currentImage;

            if (!text && !image) return;

            // UI Changes
            document.getElementById("welcome-view").style.display = "none";
            document.getElementById("chat-container").style.display = "block";
            
            // Limpa input
            input.value = "";
            input.style.height = "auto";
            clearImage(); // Remove imagem da visualiza√ß√£o de input

            // Salva msg User
            const chat = state.chats.find(c => c.id === state.currentChatId);
            const userMsg = { role: 'user', content: text, image: image };
            
            // Define t√≠tulo se for primeira msg
            if (chat.msgs.length === 0) {
                chat.title = text ? text.slice(0, 20) : "Imagem";
                renderSidebar();
            }

            chat.msgs.push(userMsg);
            saveData();
            renderMessage(userMsg);
            scrollToBottom();

            // --- L√ìGICA DE IA ---
            
            // 1. Criar indicador de "Digitando..."
            const loadingId = "loader-" + Date.now();
            const container = document.getElementById("chat-container");
            const loaderDiv = document.createElement("div");
            loaderDiv.className = "msg-row ai";
            loaderDiv.id = loadingId;
            loaderDiv.innerHTML = `<div style="width:30px; margin-right:10px;">üí†</div><div class="typing-indicator">Axion pensando...</div>`;
            container.appendChild(loaderDiv);
            scrollToBottom();

            try {
                // 2. Construir Prompt (Contexto + Sistema)
                
                // Pega as √∫ltimas 10 mensagens para mem√≥ria
                const recentMsgs = chat.msgs.slice(-10).map(m => {
                    let c = m.content;
                    if(m.image) c += " [Imagem Anexada]";
                    return `${m.role === 'user' ? 'User' : 'Assistant'}: ${c}`;
                }).join("\n");

                let systemPrompt = "System: Voc√™ √© o Axion. Responda de forma natural, √∫til e amig√°vel. N√£o mencione que voc√™ √© uma IA a menos que perguntado. Evite prefixos como 'Claro' ou 'Aqui est√°'. V√° direto ao ponto.";
                
                if (state.deepMode) {
                    systemPrompt = "System: MODO DEEP SEARCH ATIVADO. Analise profundamente a quest√£o. Use formata√ß√£o Markdown (negrito, listas, blocos de c√≥digo). Seja detalhista e t√©cnico. Pense passo a passo.";
                }

                if (image) {
                    systemPrompt += " ATEN√á√ÉO: O usu√°rio enviou uma imagem (representada em base64 no sistema). Tente inferir o contexto ou pe√ßa detalhes se necess√°rio.";
                }

                const finalPrompt = `${systemPrompt}\n\nHist√≥rico:\n${recentMsgs}\n\nAssistant:`;

                // 3. Fetch API
                const req = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ prompt: finalPrompt })
                });

                if (!req.ok) throw new Error("Falha na rede");

                const res = await req.json();
                const reply = res.reply || "N√£o consegui formular uma resposta.";

                // 4. Exibir Resposta
                document.getElementById(loadingId).remove();
                
                const aiMsg = { role: 'ai', content: reply };
                chat.msgs.push(aiMsg);
                saveData();
                renderMessage(aiMsg);
                scrollToBottom();

            } catch (err) {
                document.getElementById(loadingId).innerHTML = `<div class="msg-bubble" style="color:red">Erro de conex√£o. Tente novamente.</div>`;
            }
        }

        // --- UTILS ---
        function resizeTextarea(el) {
            el.style.height = 'auto';
            el.style.height = Math.min(el.scrollHeight, 200) + 'px';
        }

        function checkEnter(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function useSuggestion(text) {
            document.getElementById("user-input").value = text;
            sendMessage();
        }

        // --- DEEP SEARCH TOGGLE ---
        function toggleDeepSearch() {
            state.deepMode = !state.deepMode;
            const btn = document.getElementById("btn-globe");
            const input = document.getElementById("user-input");
            
            if (state.deepMode) {
                btn.classList.add("active");
                input.placeholder = "Modo Pensamento Profundo ativado...";
            } else {
                btn.classList.remove("active");
                input.placeholder = "Digite uma mensagem...";
            }
        }

        // --- IMAGEM ---
        function handleFileSelect(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    state.currentImage = e.target.result;
                    document.getElementById("img-preview-el").src = state.currentImage;
                    document.getElementById("img-preview-box").style.display = "block";
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function clearImage() {
            state.currentImage = null;
            document.getElementById("file-input").value = "";
            document.getElementById("img-preview-box").style.display = "none";
        }

        // --- MOBILE MENU ---
        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('open');
        }

    </script>
</body>
</html>